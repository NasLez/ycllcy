{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport axios from \"axios\";\nimport store from \"@/vuex/store.js\";\nexport default {\n  name: \"PaperDetail\",\n  store,\n  data() {\n    return {\n      showChannel: \"\",\n      editDialogVisible: false,\n      editStatus: \"\",\n      userinfo: {\n        \"id\": \"\",\n        \"username\": \"\",\n        \"phone\": \"\",\n        \"email\": \"\",\n        \"school\": \"\",\n        \"password\": \"\",\n        \"isAdmin\": \"\",\n        \"code\": \"\",\n        \"name\": \"\"\n      },\n      thesis: {\n        id: '',\n        name: '',\n        uploaderEmail: '',\n        maintainer: '',\n        channelId: '',\n        description: '',\n        company: '',\n        setTime: '',\n        status: ''\n      }\n    };\n  },\n  created() {\n    let that = this;\n    this.thesis.id = this.$store.state.thesis.id;\n    console.log(this.thesis.id);\n    this.userinfo.email = this.$store.state.userinfo.email;\n    console.log(this.userinfo.email);\n    console.log(\"到达详情页面\");\n    getUSerAndProject(this.userinfo.email, this.thesis.id);\n    function getUSerAndProject(email, id) {\n      axios.get(`mu/getUsernames/email=${email}`, {\n        email: email\n      }).then(res => {\n        console.log(res.data);\n        console.log(\"打印用户信息\");\n        that.$data.userinfo.id = res.data.id;\n        that.$data.userinfo.username = res.data.username;\n        that.$data.userinfo.isAdmin = res.data.isAdmin;\n        that.$data.userinfo.name = res.data.name;\n        that.$data.userinfo.phone = res.data.phone;\n        that.$data.userinfo.email = res.data.email;\n        that.$data.userinfo.school = res.data.school;\n        that.$data.userinfo.password = res.data.password;\n        that.$data.userinfo.code = res.data.code;\n        that.$data.thesis.uploaderEmail = res.data.email;\n      });\n      axios.get(`mu/thesis/queryById?id=${id}`, {\n        id: id\n      }).then(res => {\n        console.log(res.data);\n        console.log(\"项目信息\");\n        that.$data.thesis.id = res.data.id;\n        that.$data.thesis.channelId = res.data.channelId;\n        that.$data.thesis.name = res.data.name;\n        that.$data.thesis.maintainer = res.data.maintainer;\n        that.$data.thesis.description = res.data.description;\n        that.$data.thesis.company = res.data.company;\n        that.$data.thesis.setTime = res.data.submitTime;\n        that.$data.thesis.status = res.data.status;\n        axios.get(`mu/getChannelById?id=${that.$data.thesis.channelId}`).then(res => {\n          console.log(res.data);\n          console.log(\"打印通道信息\");\n          that.$data.showChannel = res.data.name;\n        });\n      });\n    }\n  },\n  methods: {\n    parseTime(time, cFormat) {\n      if (arguments.length === 0) {\n        return null;\n      }\n      const format = cFormat || '{y}-{m}-{d} {h}:{i}:{s}';\n      let date;\n      if (typeof time === 'object') {\n        date = time;\n      } else {\n        if (typeof time === 'string' && /^[0-9]+$/.test(time)) {\n          time = parseInt(time);\n        }\n        if (typeof time === 'number' && time.toString().length === 10) {\n          time = time * 1000;\n        }\n        date = new Date(time);\n      }\n      const formatObj = {\n        y: date.getFullYear(),\n        m: date.getMonth() + 1,\n        d: date.getDate(),\n        h: date.getHours(),\n        i: date.getMinutes(),\n        s: date.getSeconds(),\n        a: date.getDay()\n      };\n      const time_str = format.replace(/{([ymdhisa])+}/g, (result, key) => {\n        const value = formatObj[key];\n        // Note: getDay() returns 0 on Sunday\n        if (key === 'a') {\n          return ['日', '一', '二', '三', '四', '五', '六'][value];\n        }\n        return value.toString().padStart(2, '0');\n      });\n      return time_str;\n    },\n    edit() {\n      this.$router.push({\n        path: '/PaperEdit'\n      });\n    },\n    deleteProject() {\n      axios.delete(`mu/thesis/delete?id=${this.thesis.id}`).then(res => {\n        if (res.status === 200) {\n          this.$message.success(\"删除成功\");\n          this.$router.push({\n            path: '/UserViewProjectsAndPapers'\n          });\n        }\n      });\n    },\n    showEditDialog() {\n      this.$data.editDialogVisible = true;\n    },\n    editDialogClosed() {\n      this.$refs.editFormRef.resetFields();\n    },\n    changeStatus() {\n      let that = this;\n      axios.post(`mu/thesis/changeStatus?id=${that.$data.project.id}&status=${that.$data.editStatus}`).then(res => {\n        console.log(\"修改状态成功\");\n        console.log(res.data);\n      });\n      this.editDialogVisible = false;\n      this.thesis.status = this.editStatus;\n    },\n    downloadProfile() {\n      let that = this;\n      window.open(`mu/thesis/download/${that.$data.thesis.id}/zip`, \"_blank\");\n    },\n    downloadPic() {\n      let that = this;\n      window.open(`mu/thesis/download/${that.$data.thesis.id}/fig`, \"_blank\");\n    }\n  }\n};","map":{"version":3,"mappings":";AAyCA;AACA;AACA;EACAA;EACAC;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;MACA;MACAC;QACAC;QACAR;QACAS;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;IACA;EACA;EACAC;IACA;IACA;IACAC;IACA;IACAA;IACAA;IACAC;IACA;MACAC;QACAC;MACA;QACAH;QACAA;QACAI;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;MACA;MACAF;QACAX;MACA;QACAS;QACAA;QACAI;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAF;UACAF;UACAA;UACAI;QACA;MACA;IACA;EACA;EACAC;IACAC;MACA;QACA;MACA;MACA;MACA;MACA;QACAC;MACA;QACA;UACAC;QACA;QACA;UACAA;QACA;QACAD;MACA;MACA;QACAE;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACA;QACA;QACA;QACA;UACA;QACA;QACA;MACA;MACA;IACA;IACAC;MACA;QAAAC;MAAA;IACA;IACAC;MACAhB;QACA;UACA;UACA;YAAAe;UAAA;QACA;MACA;IACA;IACAE;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;MACAnB;QACAF;QACAA;MACA;MACA;MACA;IACA;IACAsB;MACA;MACAC;IACA;IACAC;MACA;MACAD;IACA;EACA;AAEA","names":["name","store","data","showChannel","editDialogVisible","editStatus","userinfo","thesis","id","uploaderEmail","maintainer","channelId","description","company","setTime","status","created","console","getUSerAndProject","axios","email","that","methods","parseTime","date","time","y","m","d","h","i","s","a","edit","path","deleteProject","showEditDialog","editDialogClosed","changeStatus","downloadProfile","window","downloadPic"],"sourceRoot":"src/view","sources":["PaperDetail.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <el-descriptions title=\"项目信息\">\r\n      <el-descriptions-item label=\"论文名称\">{{thesis.name}}</el-descriptions-item>\r\n      <el-descriptions-item label=\"负责人\">{{ thesis.maintainer }}</el-descriptions-item>\r\n      <el-descriptions-item label=\"论文简介\">{{ thesis.description }}</el-descriptions-item>\r\n      <el-descriptions-item label=\"论文类别\">\r\n        <el-tag size=\"small\">{{ showChannel }}</el-tag>\r\n      </el-descriptions-item>\r\n      <el-descriptions-item label=\"负责单位\">{{ thesis.company }}</el-descriptions-item>、\r\n      <el-descriptions-item label=\"上传时间\">{{parseTime(thesis.setTime)}}</el-descriptions-item>\r\n      <el-descriptions-item label=\"项目状态\">\r\n        <el-tag size=\"small\">{{thesis.status}}</el-tag>\r\n      </el-descriptions-item>\r\n      <el-descriptions-item label=\"下载\">\r\n        <el-button @click=\"downloadProfile\">点击下载论文文件</el-button>\r\n        <el-button @click=\"downloadPic\">点击下载论文凭证</el-button>\r\n        <el-button @click=\"deleteProject\">删除论文</el-button>\r\n        <el-button @click=\"edit\">编辑论文</el-button>\r\n      </el-descriptions-item>\r\n    </el-descriptions>\r\n\r\n    <el-button @click=\"showEditDialog\" v-if=\"userinfo.isAdmin == 1\">审核</el-button>\r\n\r\n    <el-card class=\"box-card\" style=\"position: absolute;left: 400px\" v-if=\"editDialogVisible\">\r\n      <el-dialog\r\n          title=\"请问您的审核结果是？\"\r\n          :visible.sync=\"editDialogVisible\"\r\n          width=\"50%\" @close=\"editDialogClosed\">\r\n        <el-radio v-model=\"editStatus\" label=\"Accept\">审核通过</el-radio>\r\n        <el-radio v-model=\"editStatus\" label=\"Reject\">审核驳回</el-radio>\r\n        <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"editDialogVisible = false; editStatus ='Waiting' \">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"changeStatus\">确 定</el-button>\r\n      </span>\r\n      </el-dialog>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from \"axios\";\r\nimport store from \"@/vuex/store.js\";\r\nexport default {\r\n  name: \"PaperDetail\",\r\n  store,\r\n  data(){\r\n    return{\r\n      showChannel:\"\",\r\n      editDialogVisible:false,\r\n      editStatus:\"\",\r\n      userinfo: {\r\n        \"id\":\"\",\r\n        \"username\": \"\",\r\n        \"phone\": \"\",\r\n        \"email\": \"\",\r\n        \"school\": \"\",\r\n        \"password\": \"\",\r\n        \"isAdmin\": \"\",\r\n        \"code\": \"\",\r\n        \"name\": \"\"\r\n      },\r\n      thesis: {\r\n        id:'',\r\n        name: '',\r\n        uploaderEmail: '',\r\n        maintainer: '',\r\n        channelId: '',\r\n        description: '',\r\n        company: '',\r\n        setTime: '',\r\n        status: '',\r\n      },\r\n    }\r\n  },\r\n  created() {\r\n    let that = this;\r\n    this.thesis.id=this.$store.state.thesis.id\r\n    console.log(this.thesis.id)\r\n    this.userinfo.email=this.$store.state.userinfo.email\r\n    console.log(this.userinfo.email)\r\n    console.log(\"到达详情页面\")\r\n    getUSerAndProject(this.userinfo.email, this.thesis.id);\r\n    function getUSerAndProject(email, id) {\r\n      axios.get(`mu/getUsernames/email=${email}`, {\r\n        email: email,\r\n      }).then(res => {\r\n        console.log(res.data);\r\n        console.log(\"打印用户信息\");\r\n        that.$data.userinfo.id = res.data.id;\r\n        that.$data.userinfo.username = res.data.username;\r\n        that.$data.userinfo.isAdmin = res.data.isAdmin;\r\n        that.$data.userinfo.name = res.data.name;\r\n        that.$data.userinfo.phone = res.data.phone;\r\n        that.$data.userinfo.email = res.data.email;\r\n        that.$data.userinfo.school = res.data.school;\r\n        that.$data.userinfo.password = res.data.password;\r\n        that.$data.userinfo.code = res.data.code;\r\n        that.$data.thesis.uploaderEmail = res.data.email;\r\n      });\r\n      axios.get(`mu/thesis/queryById?id=${id}`, {\r\n        id: id\r\n      }).then(res => {\r\n        console.log(res.data);\r\n        console.log(\"项目信息\")\r\n        that.$data.thesis.id = res.data.id;\r\n        that.$data.thesis.channelId=res.data.channelId;\r\n        that.$data.thesis.name = res.data.name;\r\n        that.$data.thesis.maintainer = res.data.maintainer;\r\n        that.$data.thesis.description = res.data.description;\r\n        that.$data.thesis.company = res.data.company;\r\n        that.$data.thesis.setTime = res.data.submitTime;\r\n        that.$data.thesis.status = res.data.status;\r\n        axios.get(`mu/getChannelById?id=${that.$data.thesis.channelId}`).then(res => {\r\n          console.log(res.data);\r\n          console.log(\"打印通道信息\")\r\n          that.$data.showChannel = res.data.name;\r\n        })\r\n      });\r\n    }\r\n  },\r\n  methods: {\r\n    parseTime(time, cFormat) {\r\n      if (arguments.length === 0) {\r\n        return null\r\n      }\r\n      const format = cFormat || '{y}-{m}-{d} {h}:{i}:{s}'\r\n      let date\r\n      if (typeof time === 'object') {\r\n        date = time\r\n      } else {\r\n        if ((typeof time === 'string') && (/^[0-9]+$/.test(time))) {\r\n          time = parseInt(time)\r\n        }\r\n        if ((typeof time === 'number') && (time.toString().length === 10)) {\r\n          time = time * 1000\r\n        }\r\n        date = new Date(time)\r\n      }\r\n      const formatObj = {\r\n        y: date.getFullYear(),\r\n        m: date.getMonth() + 1,\r\n        d: date.getDate(),\r\n        h: date.getHours(),\r\n        i: date.getMinutes(),\r\n        s: date.getSeconds(),\r\n        a: date.getDay()\r\n      }\r\n      const time_str = format.replace(/{([ymdhisa])+}/g, (result, key) => {\r\n        const value = formatObj[key]\r\n        // Note: getDay() returns 0 on Sunday\r\n        if (key === 'a') {\r\n          return ['日', '一', '二', '三', '四', '五', '六'][value]\r\n        }\r\n        return value.toString().padStart(2, '0')\r\n      })\r\n      return time_str\r\n    },\r\n    edit(){\r\n      this.$router.push({path:'/PaperEdit'})\r\n    },\r\n    deleteProject(){\r\n      axios.delete(`mu/thesis/delete?id=${this.thesis.id}`).then(res=>{\r\n        if(res.status===200){\r\n          this.$message.success(\"删除成功\")\r\n          this.$router.push({path: '/UserViewProjectsAndPapers'})\r\n        }\r\n      })\r\n    },\r\n    showEditDialog(){\r\n      this.$data.editDialogVisible = true;\r\n    },\r\n    editDialogClosed(){\r\n      this.$refs.editFormRef.resetFields()\r\n    },\r\n    changeStatus(){\r\n      let that = this;\r\n      axios.post(`mu/thesis/changeStatus?id=${that.$data.project.id}&status=${that.$data.editStatus}`).then(res => {\r\n        console.log(\"修改状态成功\")\r\n        console.log(res.data)\r\n      });\r\n      this.editDialogVisible = false\r\n      this.thesis.status = this.editStatus\r\n    },\r\n    downloadProfile(){\r\n      let that = this;\r\n      window.open(`mu/thesis/download/${that.$data.thesis.id}/zip`,\"_blank\")\r\n    },\r\n    downloadPic(){\r\n      let that = this;\r\n      window.open(`mu/thesis/download/${that.$data.thesis.id}/fig`,\"_blank\")\r\n    }\r\n  }\r\n\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}